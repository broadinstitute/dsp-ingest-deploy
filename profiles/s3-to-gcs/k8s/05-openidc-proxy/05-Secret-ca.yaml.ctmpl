{{with $secretPrefix := printf "secret/dsde/monster/%s/common" (env "ENVIRONMENT")}}
{{with $serverKey := secret (printf "%s/server.key" $secretPrefix)}}
{{with $serverCrt := secret (printf "%s/server.crt" $secretPrefix)}}
{{with $intermediateCrt := secret (printf "%s/server.intermediate.crt" $secretPrefix)}}
kind: Secret
apiVersion: v1
metadata:
    name: wildcard.{{env "DNS_ZONE_NAME"}}.broadinstitute.org
type: Opaque
data:
    tls.key: {{$serverKey.Data.value | base64Encode}}
    tls.crt: {{(printf "%s\n%s" $serverCrt.Data.value $intermediateCrt.Data.value) | base64Encode}}
{{end}}{{end}}{{end}}{{end}}
